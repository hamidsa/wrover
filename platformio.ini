[env:esp32-wrover]
platform = espressif32
board = esp32-wrover
framework = arduino
monitor_speed = 115200
lib_deps = 
    bodmer/TFT_eSPI@^2.5.0
    bblanchon/ArduinoJson@^6.21.3
    links2004/WebSockets@^2.3.6

build_flags = 
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DCORE_DEBUG_LEVEL=1

upload_speed = 921600
board_build.partitions = default_8MB.csv

; Debug configuration
debug_tool = esp-prog
debug_init_break = tbreak setup

; Library configuration
lib_ldf_mode = deep+
lib_deps_builtin = 
    SPI
    WiFi
    EEPROM
    HTTPClient
    WebServer

; Build optimization
build_unflags = -std=gnu++11
build_flags = 
    -std=gnu++17
    -fexceptions
    -Wno-error=maybe-uninitialized
    -Wno-error=unused-variable

; Memory optimization
board_build.flash_mode = qio
board_build.f_flash = 80000000L
board_build.flash_size = 8MB

; PSRAM configuration
board_build.embed_txtfiles = 
    partitions.csv
build_flags = 
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue

; Monitor configuration
monitor_filters = 
    colorize
    esp32_exception_decoder
monitor_raw = yes

; Custom targets
extra_scripts = 
    pre:extra_script.py

; Override default upload port
upload_port = /dev/ttyUSB0

; Set debug level
debug_level = verbose

; Enable C++ exceptions
build_unflags = -fno-exceptions
build_flags = -fexceptions